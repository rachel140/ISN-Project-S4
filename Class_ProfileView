import tkinter as tk

class ProfileView:
    
    def __init__(self, parent, country_per_long, sea_level=0):
        """
        Initialize the profile view for a country.
        
        Parameters:
        - parent: the parent window
        - country_per_long: dictionnary {longitude: average_elevation}
        - sea_level: float (sea will be displayed in blue)
        """
        
        self.parent = parent
        self.country_per_long = country_per_long
        self.sea_level = sea_level
        self.draw_profile()

    def draw_profile(self):
        margin_x = 20       # horizontal margin (on left and right) -nb of pixels
        margin_y = 20        # vertical margin (on top and bottom) -nb of pixels
        space_x = 5        # horizontal space between each longitude point -nb of pixels
        sea_height = 20     # height of the blue sea at the bottom -nb of pixels

        # determination highest elevation to set canvas height
        max_elev = max(self.country_per_long.values()) +self.sea_level

        # computation size canvas 
        width = len(self.country_per_long) * space_x + 2 * margin_x
        height = max_elev + sea_height + margin_y * 2

        # creation canvas
        self.canvas = tk.Canvas(self.parent, width=width, height=height, bg="white")
        self.canvas.pack()

        # Draw the sea as a blue rectangle at the bottom of the canvas
        self.canvas.create_rectangle(0, height - sea_height, width, height, fill="blue", outline="blue")

        # Draw elevation points 
        points = []  # store converted (x, y) positions
        for i, (longitude, elevation) in enumerate(sorted(self.country_per_long.items())):
            x = margin_x + i * space_x  # X position spaced by index
            y = height - sea_height - elevation  # Y position inverted because canvas Y=0 is at the top
            points.append((x, y))
            # Draw a small black dot at the point
            self.canvas.create_oval(x - 1, y - 1, x + 1, y + 1, fill="black")

        # Connect points with lines
        for i in range(len(points) - 1):
            x0, y0 = points[i]
            x1, y1 = points[i + 1]
            self.canvas.create_line(x0, y0, x1, y1, fill= 'green' , width=2)

        # Draw elevation scale on the right
        scale_x = width - 10  # position of the vertical scale (near right edge)
        self.canvas.create_line(scale_x, height - sea_height, scale_x, height - sea_height - max_elev, fill="black")

        # Add text labels for 0 m and max elevation
        self.canvas.create_text(scale_x - 5, height - sea_height,text="0 m", font=("comic sans ms", 10))
        self.canvas.create_text(scale_x - 5, height - sea_height - max_elev, text=f"{int(max_elev)} m", font=("comic sans ms", 10))

# TEST
if __name__ == "__main__":
    root = tk.Tk()
    dummy_data = {i: abs(50 - i) + 5 for i in range(100)}  # petit relief pyramidal
    ProfileView(root, dummy_data, sea_level=0)
    root.mainloop()

# Dico per longitude ==> to be place in right class
def build_dico_per_long (new_country) : 
    
    """
    This functions computes the average of all the latitudes for each longitude of the country
    
    Parameters : 
    -------
    new_country: dict
    
    Returns : 
    -------
    country_per_long: dict
    Of the form { long : average_lat â€¦}
    """
    
    dico_per_long = {} 
    for i in new_country : 
        longitude = new_country.[i][1]
        elevation = new_country.[i][2]
        if longitude in dico_per_long :
            dico_per_long[longitude].append(elevation)
        else : 
            dico_per_long[longitude]=[elevation]
    for j in dico_per_long.values :
        average : (sum(j)/(len(j))
        dico_per_long[i]=average
    return dico_per_long
    
            
    
    
    new_country = {point _2= [lat2, long2, elev2]..  : dict
